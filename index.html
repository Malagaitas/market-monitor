<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>GPT - Great Portfolio Tracer</title>
  <meta name="description" content="Great Portfolio Tracer — sidebar with categories, global search, favorites, and an advanced chart."/>
  <meta name="theme-color" content="#0f62fe"/>
  <link rel="icon" type="image/svg+xml" href="logo.svg"/>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png"/>
  <style>
    :root {
      --brand:#0f62fe;
      --bg:#f5f7fb;
      --card:#ffffff;
      --text:#0b1221;
      --muted:#66758f;
      --border:#e5e8ef;
      --sidebar:#eef2ff;
      --star:#ffb400;
    }
    [data-theme="dark"] {
      --bg:#0b0f17;
      --card:#111827;
      --text:#f5f7fb;
      --muted:#b6c0d1;
      --border:#24324a;
      --sidebar:#0f172a;
      --star:#ffd166;
    }
    * { box-sizing:border-box; }
    html, body { height:100%; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background:var(--bg); color:var(--text);}
    header { padding: 10px 16px; background: var(--brand); color: white; display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .brand { display:flex; align-items:center; gap:10px; }
    .brand img { height:26px; width:auto; display:block; }
    .toggle-btn { display:inline-flex; align-items:center; gap:8px; background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.3); color:#fff;
                   padding:6px 10px; border-radius:999px; cursor:pointer; font-weight:600; }
    .toggle-btn svg { width:18px; height:18px; }
    main { max-width: 1400px; margin: 0 auto; padding: 16px; }
    .section { margin-top: 16px; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:12px; box-shadow: 0 1px 2px rgba(0,0,0,.06); }
    .layout { display:grid; grid-template-columns: 260px 340px 1fr; gap:16px; align-items:start; }
    .sidebar { background:var(--sidebar); border:1px solid var(--border); border-radius:12px; padding:12px; }
    .sidebar h3 { margin:4px 0 8px; font-size:14px; opacity:.9; }
    .nav-group { margin-bottom:10px; }
    .nav-item { display:block; width:100%; text-align:left; border:1px solid var(--border); background:var(--card); color:var(--text);
                 padding:8px 10px; border-radius:8px; cursor:pointer; margin-bottom:6px; font-weight:600; }
    .nav-item.active { background: var(--brand); border-color: var(--brand); color:white; }
    .list { border:1px solid var(--border); border-radius:12px; background:var(--card); }
    .list-header { display:flex; align-items:center; gap:8px; padding:10px; border-bottom:1px solid var(--border); justify-content:space-between; }
    .search input { width:100%; padding:8px 10px; border:1px solid var(--border); border-radius:8px; background:var(--bg); color:var(--text); }
    .row { display:flex; justify-content:space-between; align-items:center; gap:8px; padding:10px 12px; border-top:1px solid var(--border); cursor:pointer; }
    .row:hover { background: rgba(15, 98, 254, .08); }
    .left { display:flex; flex-direction:column; gap:3px; }
    .symbol { font-weight:700; }
    .muted { color:var(--muted); font-size:12px; }
    .pill { font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid var(--border); color:var(--muted); }
    .controls { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .btn { appearance:none; border:1px solid var(--border); background:var(--card); padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:600; color:var(--text); }
    .btn.active { background: var(--brand); border-color: var(--brand); color:white; }
    .star { font-size:18px; margin-left:8px; user-select:none; }
    .star.fav { color: var(--star); }
    footer { text-align:center; color:var(--muted); padding: 16px; border-top:1px solid var(--border); margin-top:24px; }
    @media (max-width: 1080px) {
      .layout { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img src="logo.svg" alt="GPT logo" />
      <strong>GPT - Great Portfolio Tracer</strong>
    </div>
    <button id="themeToggle" class="toggle-btn" title="Toggle light/dark">
      <span id="themeIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.79 1.8-1.79zm10.48 14.32l1.79 1.79 1.79-1.79-1.79-1.79-1.79 1.79zM12 4V1h-0v3h0zm0 19v-3h-0v3h0zm8-11h3v0h-3v0zm-19 0v0h3v0H1zM6.76 19.16l-1.8 1.79-1.79-1.79 1.79-1.79 1.8 1.79zM17.24 4.84l1.79-1.79 1.79 1.79-1.79 1.79-1.79-1.79zM12 7a5 5 0 100 10 5 5 0 000-10z"/></svg>
      </span>
      <span id="themeLabel">Light</span>
    </button>
  </header>

  <main>
    <!-- Top ticker -->
    <div class="section card">
      <div id="ticker-host">
        <div class="tradingview-widget-container"><div class="tradingview-widget-container__widget"></div></div>
      </div>
    </div>

    <!-- Three-column layout -->
    <div class="section layout">
      <!-- Sidebar -->
      <aside class="sidebar">
        <h3>Asset classes</h3>
        <div id="sidebar"></div>
      </aside>

      <!-- Symbol list -->
      <section class="list">
        <div class="list-header">
          <div class="controls">
            <strong id="listTitle">Symbols</strong>
            <span class="pill" id="countPill">0</span>
          </div>
          <div class="search"><input id="search" type="text" placeholder="Global search (e.g., NVDA, Bitcoin)"/></div>
        </div>
        <div id="symbolList"></div>
      </section>

      <!-- Advanced chart -->
      <section class="card">
        <div class="controls" style="justify-content:space-between; align-items:center; margin-bottom:8px;">
          <div class="controls">
            <strong>Interval:</strong>
            <button class="btn" data-int="D">1D</button>
            <button class="btn" data-int="W">1W</button>
            <button class="btn" data-int="60">1H</button>
          </div>
          <div class="controls">
            <strong>Range:</strong>
            <button class="btn" data-range="1D">1D</button>
            <button class="btn" data-range="1M">1M</button>
            <button class="btn" data-range="3M">3M</button>
            <button class="btn" data-range="YTD">YTD</button>
            <button class="btn" data-range="12M">1Y</button>
            <button class="btn" data-range="60M">5Y</button>
            <button class="btn" data-range="120M">10Y</button>
            <button class="btn" data-range="ALL">ALL</button>
          </div>
        </div>
        <div id="adv-host" style="height:620px;"></div>
        <p class="muted">Click a symbol in the middle list to load it on the chart. Click ★ to add/remove favorites.</p>
      </section>
    </div>
  </main>

  <footer>GPT - Great Portfolio Tracer</footer>

  <script>
    // ====== Data ======
    const TICKER_CFG = {
      light: {
  "symbols": [
    {
      "proName": "NASDAQ:NVDA",
      "title": "NVDA"
    },
    {
      "proName": "NASDAQ:MSFT",
      "title": "MSFT"
    },
    {
      "proName": "NASDAQ:AAPL",
      "title": "AAPL"
    },
    {
      "proName": "NASDAQ:AMZN",
      "title": "AMZN"
    },
    {
      "proName": "NASDAQ:META",
      "title": "META"
    },
    {
      "proName": "NASDAQ:AVGO",
      "title": "AVGO"
    },
    {
      "proName": "NASDAQ:GOOGL",
      "title": "GOOGL"
    },
    {
      "proName": "NASDAQ:GOOG",
      "title": "GOOG"
    },
    {
      "proName": "NYSE:BRK.B",
      "title": "BRK.B"
    },
    {
      "proName": "NASDAQ:TSLA",
      "title": "TSLA"
    },
    {
      "proName": "BINANCE:BTCUSDT",
      "title": "BTCUSDT"
    },
    {
      "proName": "BINANCE:ETHUSDT",
      "title": "ETHUSDT"
    },
    {
      "proName": "BINANCE:BNBUSDT",
      "title": "BNBUSDT"
    },
    {
      "proName": "BINANCE:SOLUSDT",
      "title": "SOLUSDT"
    },
    {
      "proName": "KRAKEN:USDTUSD",
      "title": "USDTUSD"
    }
  ],
  "showSymbolLogo": true,
  "isTransparent": false,
  "displayMode": "adaptive",
  "colorTheme": "light",
  "locale": "en"
},
      dark: {
  "symbols": [
    {
      "proName": "NASDAQ:NVDA",
      "title": "NVDA"
    },
    {
      "proName": "NASDAQ:MSFT",
      "title": "MSFT"
    },
    {
      "proName": "NASDAQ:AAPL",
      "title": "AAPL"
    },
    {
      "proName": "NASDAQ:AMZN",
      "title": "AMZN"
    },
    {
      "proName": "NASDAQ:META",
      "title": "META"
    },
    {
      "proName": "NASDAQ:AVGO",
      "title": "AVGO"
    },
    {
      "proName": "NASDAQ:GOOGL",
      "title": "GOOGL"
    },
    {
      "proName": "NASDAQ:GOOG",
      "title": "GOOG"
    },
    {
      "proName": "NYSE:BRK.B",
      "title": "BRK.B"
    },
    {
      "proName": "NASDAQ:TSLA",
      "title": "TSLA"
    },
    {
      "proName": "BINANCE:BTCUSDT",
      "title": "BTCUSDT"
    },
    {
      "proName": "BINANCE:ETHUSDT",
      "title": "ETHUSDT"
    },
    {
      "proName": "BINANCE:BNBUSDT",
      "title": "BNBUSDT"
    },
    {
      "proName": "BINANCE:SOLUSDT",
      "title": "SOLUSDT"
    },
    {
      "proName": "KRAKEN:USDTUSD",
      "title": "USDTUSD"
    }
  ],
  "showSymbolLogo": true,
  "isTransparent": false,
  "displayMode": "adaptive",
  "colorTheme": "dark",
  "locale": "en"
}
    };
    const CATALOG = {"favorites": {"label": "\u2605 Favorites", "groups": {"my_favs": {"label": "My Favorites", "symbols": []}}}, "equities": {"label": "Stocks", "groups": {"sp_top20": {"label": "S&P Top 20", "symbols": [{"s": "NASDAQ:NVDA", "d": "NVDA \u2014 NVIDIA"}, {"s": "NASDAQ:MSFT", "d": "MSFT \u2014 Microsoft"}, {"s": "NASDAQ:AAPL", "d": "AAPL \u2014 Apple"}, {"s": "NASDAQ:AMZN", "d": "AMZN \u2014 Amazon"}, {"s": "NASDAQ:META", "d": "META \u2014 Meta"}, {"s": "NASDAQ:AVGO", "d": "AVGO \u2014 Broadcom"}, {"s": "NASDAQ:GOOGL", "d": "GOOGL \u2014 Alphabet A"}, {"s": "NASDAQ:GOOG", "d": "GOOG \u2014 Alphabet C"}, {"s": "NYSE:BRK.B", "d": "BRK.B \u2014 Berkshire B"}, {"s": "NASDAQ:TSLA", "d": "TSLA \u2014 Tesla"}, {"s": "NYSE:JPM", "d": "JPM \u2014 JPMorgan"}, {"s": "NYSE:WMT", "d": "WMT \u2014 Walmart"}, {"s": "NYSE:LLY", "d": "LLY \u2014 Eli Lilly"}, {"s": "NYSE:V", "d": "V \u2014 Visa"}, {"s": "NYSE:ORCL", "d": "ORCL \u2014 Oracle"}, {"s": "NYSE:MA", "d": "MA \u2014 Mastercard"}, {"s": "NASDAQ:NFLX", "d": "NFLX \u2014 Netflix"}, {"s": "NYSE:XOM", "d": "XOM \u2014 ExxonMobil"}, {"s": "NASDAQ:COST", "d": "COST \u2014 Costco"}, {"s": "NYSE:JNJ", "d": "JNJ \u2014 Johnson & Johnson"}]}, "mega_caps": {"label": "US Mega Caps", "symbols": [{"s": "NASDAQ:NVDA", "d": "NVDA \u2014 NVIDIA"}, {"s": "NASDAQ:MSFT", "d": "MSFT \u2014 Microsoft"}, {"s": "NASDAQ:AAPL", "d": "AAPL \u2014 Apple"}, {"s": "NASDAQ:AMZN", "d": "AMZN \u2014 Amazon"}, {"s": "NASDAQ:META", "d": "META \u2014 Meta"}, {"s": "NASDAQ:AVGO", "d": "AVGO \u2014 Broadcom"}, {"s": "NASDAQ:GOOGL", "d": "GOOGL \u2014 Alphabet A"}, {"s": "NASDAQ:GOOG", "d": "GOOG \u2014 Alphabet C"}, {"s": "NYSE:BRK.B", "d": "BRK.B \u2014 Berkshire B"}, {"s": "NASDAQ:TSLA", "d": "TSLA \u2014 Tesla"}]}}}, "crypto": {"label": "Crypto", "groups": {"top_volume": {"label": "Top by Volume", "symbols": [{"s": "BINANCE:BTCUSDT", "d": "BTCUSDT \u2014 Bitcoin"}, {"s": "BINANCE:ETHUSDT", "d": "ETHUSDT \u2014 Ethereum"}, {"s": "BINANCE:BNBUSDT", "d": "BNBUSDT \u2014 BNB"}, {"s": "BINANCE:SOLUSDT", "d": "SOLUSDT \u2014 Solana"}, {"s": "KRAKEN:USDTUSD", "d": "USDTUSD \u2014 Tether (USD)"}]}}}};

    // Flatten all symbols for GLOBAL SEARCH
    function flattenAllSymbols() {
      const arr = [];
      Object.values(CATALOG).forEach(asset => {
        Object.values(asset.groups).forEach(g => {
          g.symbols.forEach(x => arr.push({ s: x.s, d: x.d }));
        });
      });
      // Remove duplicates by symbol
      const seen = new Set();
      return arr.filter(x => (seen.has(x.s) ? false : (seen.add(x.s), true)));
    }
    const ALL_SYMBOLS = flattenAllSymbols();

    // ====== Theme ======
    const themeBtn = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const themeLabel = document.getElementById('themeLabel');
    let theme = localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', theme);
    function updateThemeIcon() {
      if (theme === 'dark') {
        themeIcon.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>';
        themeLabel.textContent = 'Dark';
      } else {
        themeIcon.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.79 1.8-1.79zm10.48 14.32l1.79 1.79 1.79-1.79-1.79-1.79-1.79 1.79zM12 4V1h-0v3h0zm0 19v-3h-0v3h0zm8-11h3v0h-3v0zm-19 0v0h3v0H1zM6.76 19.16l-1.8 1.79-1.79-1.79 1.79-1.79 1.8 1.79zM17.24 4.84l1.79-1.79 1.79 1.79-1.79 1.79-1.79-1.79zM12 7a5 5 0 100 10 5 5 0 000-10z"/></svg>';
        themeLabel.textContent = 'Light';
      }
    }
    updateThemeIcon();
    themeBtn.addEventListener('click', () => {
      theme = (theme === 'light') ? 'dark' : 'light';
      localStorage.setItem('theme', theme);
      document.documentElement.setAttribute('data-theme', theme);
      updateThemeIcon();
      renderTicker();
      renderAdvanced();
    });

    // ====== Ticker ======
    const tickerHost = document.getElementById('ticker-host');
    function renderTicker() {
      tickerHost.innerHTML = '<div class="tradingview-widget-container"><div class="tradingview-widget-container__widget"></div></div>';
      const script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js';
      script.async = true;
      script.innerHTML = JSON.stringify(TICKER_CFG[theme], null, 2);
      tickerHost.querySelector('.tradingview-widget-container').appendChild(script);
    }
    renderTicker();

    // ====== Favorites store ======
    function loadFavs() {
      try { return JSON.parse(localStorage.getItem('favorites') || '[]'); } catch (e) { return []; }
    }
    function saveFavs(list) {
      localStorage.setItem('favorites', JSON.stringify(list));
    }
    function isFav(symbol) {
      return loadFavs().some(x => x.s === symbol);
    }
    function toggleFav(item) {
      let favs = loadFavs();
      if (isFav(item.s)) {
        favs = favs.filter(x => x.s !== item.s);
      } else {
        favs.push({ s: item.s, d: item.d || '' });
      }
      saveFavs(favs);
    }

    // ====== Sidebar ======
    const sidebar = document.getElementById('sidebar');
    let currentAsset = localStorage.getItem('asset') || 'equities';
    let currentGroup = localStorage.getItem('group') || 'sp_top20';

    function renderSidebar() {
      sidebar.innerHTML = '';
      Object.entries(CATALOG).forEach(([assetId, asset]) => {
        const group = document.createElement('div');
        group.className = 'nav-group';
        const title = document.createElement('div');
        title.style.cssText = 'font-weight:800; margin:8px 0 6px; font-size:13px; text-transform:uppercase; opacity:.8;';
        title.textContent = asset.label;
        group.appendChild(title);
        Object.entries(asset.groups).forEach(([groupId, g]) => {
          const btn = document.createElement('button');
          btn.className = 'nav-item' + ((assetId===currentAsset && groupId===currentGroup) ? ' active' : '');
          btn.textContent = g.label;
          btn.addEventListener('click', () => {
            currentAsset = assetId;
            currentGroup = groupId;
            localStorage.setItem('asset', currentAsset);
            localStorage.setItem('group', currentGroup);
            renderSidebar();
            renderList();
          });
          group.appendChild(btn);
        });
        sidebar.appendChild(group);
      });
    }
    renderSidebar();

    // ====== Symbol list + GLOBAL SEARCH ======
    const listTitle = document.getElementById('listTitle');
    const countPill = document.getElementById('countPill');
    const listHost = document.getElementById('symbolList');
    const searchInput = document.getElementById('search');

    function getGroupSymbols() {
      if (currentAsset === 'favorites') {
        return loadFavs();
      }
      return CATALOG[currentAsset].groups[currentGroup].symbols;
    }
    function getGlobalResults(q) {
      const qq = q.toLowerCase();
      return ALL_SYMBOLS.filter(x => x.s.toLowerCase().includes(qq) || (x.d||'').toLowerCase().includes(qq));
    }

    function renderList() {
      const q = (searchInput.value || '').trim();
      let symbols, title;
      if (q.length > 0) {
        symbols = getGlobalResults(q);
        title = 'Search results';
      } else if (currentAsset === 'favorites') {
        symbols = getGroupSymbols();
        title = 'My Favorites';
      } else {
        const meta = CATALOG[currentAsset].groups[currentGroup];
        symbols = meta.symbols;
        title = meta.label;
      }
      listTitle.textContent = title;
      countPill.textContent = symbols.length + ' items';
      listHost.innerHTML = '';

      symbols.forEach(obj => {
        const row = document.createElement('div');
        row.className = 'row';
        // Left block with symbol + desc
        const left = document.createElement('div');
        left.className = 'left';
        const sym = document.createElement('div');
        sym.className = 'symbol';
        sym.textContent = obj.s;
        const desc = document.createElement('div');
        desc.className = 'muted';
        desc.textContent = obj.d || '';
        left.appendChild(sym); left.appendChild(desc);

        // Right block with star + arrow
        const right = document.createElement('div');
        right.style.display = 'flex';
        right.style.alignItems = 'center';

        const star = document.createElement('span');
        star.className = 'star' + (isFav(obj.s) ? ' fav' : '');
        star.textContent = isFav(obj.s) ? '★' : '☆';
        star.title = isFav(obj.s) ? 'Remove from favorites' : 'Add to favorites';
        star.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleFav(obj);
          // Update star state
          star.classList.toggle('fav');
          star.textContent = star.classList.contains('fav') ? '★' : '☆';
          star.title = star.classList.contains('fav') ? 'Remove from favorites' : 'Add to favorites';
          // If on favorites view and removed, refresh list
          if (currentAsset === 'favorites' && !star.classList.contains('fav')) {
            renderList();
          }
        });

        const arrow = document.createElement('div');
        arrow.className = 'muted';
        arrow.style.marginLeft = '8px';
        arrow.textContent = '➜';

        right.appendChild(star); right.appendChild(arrow);

        row.appendChild(left); row.appendChild(right);

        row.addEventListener('click', () => {
          advSymbol = obj.s;
          localStorage.setItem('lastSymbol', advSymbol);
          renderAdvanced();
        });
        listHost.appendChild(row);
      });
    }
    searchInput.addEventListener('input', () => renderList());
    renderList();

    // ====== Advanced chart ======
    const advHost = document.getElementById('adv-host');
    const intButtons = Array.from(document.querySelectorAll('.btn[data-int]'));
    const rangeButtons = Array.from(document.querySelectorAll('.btn[data-range]'));
    let advSymbol = localStorage.getItem('lastSymbol') || getGroupSymbols()[0]?.s || 'NASDAQ:NVDA';
    let advInterval = localStorage.getItem('interval') || 'D';
    let advRange = localStorage.getItem('range') || '12M';

    function syncActiveButtons() {
      intButtons.forEach(b => b.classList.toggle('active', b.dataset.int === advInterval));
      rangeButtons.forEach(b => b.classList.toggle('active', b.dataset.range === advRange));
    }
    syncActiveButtons();

    function renderAdvanced() {
      syncActiveButtons();
      advHost.innerHTML = '<div class="tradingview-widget-container"><div class="tradingview-widget-container__widget"></div></div>';
      const script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js';
      script.async = true;
      const cfg = {
        autosize: true,
        symbol: advSymbol,
        interval: advInterval,
        range: advRange,
        timezone: 'Etc/UTC',
        theme: theme,
        style: '1',
        locale: 'en',
        allow_symbol_change: false,
        withdateranges: true,
        hide_side_toolbar: false,
        hide_top_toolbar: false,
        save_image: false,
        studies: [],
        calendar: false,
        support_host: 'https://www.tradingview.com'
      };
      script.innerHTML = JSON.stringify(cfg, null, 2);
      advHost.querySelector('.tradingview-widget-container').appendChild(script);
    }
    intButtons.forEach(btn => btn.addEventListener('click', () => {
      advInterval = btn.dataset.int;
      localStorage.setItem('interval', advInterval);
      renderAdvanced();
    }));
    rangeButtons.forEach(btn => btn.addEventListener('click', () => {
      advRange = btn.dataset.range;
      localStorage.setItem('range', advRange);
      renderAdvanced();
    }));
    renderAdvanced();
  </script>
</body>
</html>
